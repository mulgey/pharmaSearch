doctype html
html
  head
    // Import Google Icon Font
    link(href='https://fonts.googleapis.com/icon?family=Material+Icons', rel='stylesheet')
    // Compiled and minified CSS
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css')
    // Let browser know website is optimized for mobile
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
  body
    .container
      form.row(action='#')
        .input-field.col.s12.l4(style='margin-top: 2rem; margin-left: 1rem;')
          select#activeSubstance
            option(value='', disabled='', selected='') Active Substance Focused
            option(value='1') Amikacin sulfate
            option(value='2') Ampicillin sodium / Sulbactam sodium
            option(value='3') Cefoperazone sodium / Sulbactam sodium
            option(value='4') Amikacin sulfate
            option(value='5') Ampicillin sodium / Sulbactam sodium
            option(value='6') Cefoperazone sodium / Sulbactam sodium
            option(value='7') Amikacin sulfate
            option(value='8') Ampicillin sodium / Sulbactam sodium
            option(value='9') Cefoperazone sodium / Sulbactam sodium
            option(value='10') Amikacin sulfate
            option(value='11') Ampicillin sodium / Sulbactam sodium
            option(value='12') Cefoperazone sodium / Sulbactam sodium
            option(value='13') Amikacin sulfate
            option(value='14') Ampicillin sodium / Sulbactam sodium
            option(value='15') Cefoperazone sodium / Sulbactam sodium
            option(value='16') Amikacin sulfate
            option(value='17') Ampicillin sodium / Sulbactam sodium
            option(value='18') Cefoperazone sodium / Sulbactam sodium
          label Optional
        .switch
          label#rlabel.col.s12(style='font-weight: bold; font-size: larger; color: steelblue;')
            input#retrospective(type='checkbox')
            span.lever
            | Retrospective
          label#wlabel.col.s12(style='margin-top: 1rem; font-weight: bold; font-size: larger; color: steelblue;')
            input#wardfocused(type='checkbox')
            span.lever
            | Ward Focused
          label#ilabel.col.s12(style='margin-top: 1rem; font-weight: bold; font-size: larger; color: steelblue;')
            input#indicationfocused(type='checkbox')
            span.lever
            | Indication Focused
          //  
            label.col.s12(style='margin-top: 1rem; font-weight: bold; font-size: larger; color: steelblue;')
              input(type='checkbox')
              span.lever
              | Active Substance Focused
            label.col.s12(style='margin-top: 1rem; font-weight: bold; font-size: larger; color: steelblue;')
              input(type='checkbox')
              span.lever
              | Includes Economic Outcomes
            label.col.s12(style='margin-top: 1rem; font-weight: bold; font-size: larger; color: steelblue;')
              input(type='checkbox')
              span.lever
              | Requires Physician Collaboration
            label.col.s12(style='margin-top: 1rem; font-weight: bold; font-size: larger; color: steelblue;')
              input(type='checkbox')
              span.lever
              | Pharmacogenetics Focused
      .row(style='margin-top: 2rem;')
        a#search.col.waves-effect.waves-light.btn
          | Search
          i.material-icons.right search
    // Compiled and minified JavaScript
    script(src='https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js')
    script(src='https://code.jquery.com/jquery-3.4.1.min.js', integrity='sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=', crossorigin='anonymous')
    script.
      M.AutoInit();
    script.
      var dataReq = new XMLHttpRequest();
      var url = "data/data.json";
      dataReq.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
      console.log('Data loaded with success!');
      }
      };
      dataReq.open("GET", url, true);
      dataReq.send();
    //
      script.
        var filterReq = new XMLHttpRequest();
        var url = "data/filter.json";
        filterReq.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
        console.log('Filter loaded with success!');
        } else {
        console.log('Filter was not loaded');  
        }
        };
        filterReq.open("GET", url, true);
        filterReq.send();
    script.
      let filterArr = [false, false, false];
      let myData;
      var searchObj = new Object();
      let actSubs;
      $( "#retrospective" ).click(function() {
      if (filterArr[0] === false) {
      filterArr[0] = true;
      } else {
      filterArr[0] = false;
      }
      });
      $( "#wardfocused" ).click(function() {
      if (filterArr[1] === false) {
      filterArr[1] = true;
      } else {
      filterArr[1] = false;
      }
      });
      $( "#indicationfocused" ).click(function() {
      if (filterArr[2] === false) {
      filterArr[2] = true;
      } else {
      filterArr[2] = false;
      }
      });
      $("#search").click(function() {
      let actSubs = $("#activeSubstance :selected").text();
      console.log(actSubs);
      searchObj = {
      title: "",
      url: "",
      retrospective: [2],
      ward_focused: [2],
      indication_focused: [2],
      };
      let myData = JSON.parse(dataReq.responseText);
      console.log(myData);
      if (filterArr[0] === true) {
      searchObj['retrospective'] = [1];
      }
      if (filterArr[1] === true) {
      searchObj['ward_focused'] = [1];
      }
      if (filterArr[2] === true) {
      searchObj['indication_focused'] = [1];
      }
      // console.log(searchObj);

      // filterPlainFunction starts
      // ignores case-sensitive
      const getValue = value => (typeof value === 'string' ? value.toUpperCase() : value);

      /**
      * Filters an array of objects (one level-depth) with multiple criteria.
      *
      * @param  {Array}  array: the array to filter
      * @param  {Object} filters: an object with the filter criteria
      * @return {Array}
      */
      function filterPlainArray(array, filters) {
      const filterKeys = Object.keys(filters);
      return array.filter(item => {
      // validates all filter criteria
      return filterKeys.every(key => {
      // ignores an empty filter
      if (!filters[key].length) return true;
      return filters[key].find(filter => getValue(filter) === getValue(item[key]));
      });
      });
      }
      
      let result = filterPlainArray(myData, searchObj);
      console.log(result);
      });
    script.
      // ignores case-sensitive
      const getValue = value => (typeof value === 'string' ? value.toUpperCase() : value);

      /**
      * Filters an array of objects (one level-depth) with multiple criteria.
      *
      * @param  {Array}  array: the array to filter
      * @param  {Object} filters: an object with the filter criteria
      * @return {Array}
      */
      function filterPlainArray(array, filters) {
      const filterKeys = Object.keys(filters);
      return array.filter(item => {
      // validates all filter criteria
      return filterKeys.every(key => {
      // ignores an empty filter
      if (!filters[key].length) return true;
      return filters[key].find(filter => getValue(filter) === getValue(item[key]));
      });
      });
      }

      const products = [
      {
      title: "Real-world evidence of high-cost drugs for metastatic melanoma: effectiveness, compliance to clinical practice guidelines and economic evaluation",
      url: "https://ejhp.bmj.com/content/26/Suppl_1/A5.1",
      retrospective: 1,
      ward_focused: 2,
      indication_focused: 1
      },
      {
      title: "Real-world safety and tolerability of the recently commercialised palbociclib",
      url: "https://ejhp.bmj.com/content/26/Suppl_1/A223.2",
      retrospective: 2,
      ward_focused: 1,
      indication_focused: 2
      },
      {
      title: "Cost-effectiveness of morphine versus fentanyl in managing ventilated neonates with respiratory distress syndrome in the intensive care setting",
      url: "https://ejhp.bmj.com/content/26/Suppl_1/A7.3",
      retrospective: 1,
      ward_focused: 1,
      indication_focused: 1
      },
      {
      title: "Chemical risk assessement in a quality control laboratory by a tool using activity analysis",
      url: "https://ejhp.bmj.com/content/26/Suppl_1/A9.2",
      retrospective: 2,
      ward_focused: 2,
      indication_focused: 2
      }
      ]

      const filters = {
      title: ['Chemical risk assessement in a quality control laboratory by a tool using activity analysis'],
      // retrospective: [2],
      // ward_focused: [1],
      };


      const filtered = filterPlainArray(products, filters);

      const urun = [
      { name: 'A', color: 'Blue', size: 50 },
      { name: 'B', color: 'Blue', size: 60 },
      { name: 'C', color: 'Black', size: 70 },
      { name: 'D', color: 'Green', size: 50 },
      ];

      const filtre = {
      size: [70],
      };

      const filtrelenmis = filterPlainArray(urun, filtre);