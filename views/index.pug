doctype html
html
  head
    // Import Google Icon Font
    link(href='https://fonts.googleapis.com/icon?family=Material+Icons', rel='stylesheet')
    // Compiled and minified CSS
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css')
    // My very own great CSS
    link(rel='stylesheet', href='css/style.css')
    // Let browser know website is optimized for mobile
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
  body
    .navbar-fixed(style='margin-bottom: 2rem;')  
      nav
        .nav-wrapper(style='background-color: indianred;')
          a.brand-logo(href='#' style='margin-left: 2rem;') PharmaSearch
          ul#nav-mobile.right.hide-on-med-and-down
            li
              a(href='#' style='margin-right: 2rem;') About
    .container
      form.row(action='#')
        .input-field.col.s12.l4.offset-l1
          select(multiple='')#activeSubstance
            option(value='', disabled='') None
            option(value='Palbociclib') Palbociclib
            option(value='Morphine') Morphine
            option(value='Fentanyl') Fentanyl
            option(value='Piperacillin - Tazobactam') Piperacillin - Tazobactam
          label Active Substance Focused
        .input-field.col.s12.l4.offset-l1
          select(multiple='')#ward
            option(value='', disabled='') None
            option(value='Intensive Care') Intensive Care
            option(value='Oncology') Oncology
            option(value='Surgery') Surgery
          label Ward Focused
    .container.center-align(style='margin-top: 1rem;')
      .row.switch
          label#rlabel.col.s12.l3(style='font-weight: bold; font-size: larger; color: steelblue;')
            input#retrospective(type='checkbox')
            span.lever
            | Retrospective
          label#wlabel.col.s12.l3(style='font-weight: bold; font-size: larger; color: steelblue;')
            input#wardfocused(type='checkbox')
            span.lever
            | Cost Saving
    .container(style='margin-top: 4rem;')
      .row
        a#search.col.s2.waves-effect.waves-light.btn.offset-s5(style='border-radius: 12px;')
          | Search
          i.material-icons.right search
    .container
      #resultRow.row(style='margin-top: 2rem; display: none;')
        #resultText.col.s12.p(style= 'font-size: large;')
        h3.col.s12(style='margin-top: 1rem; font-weight: bold; color: darkred;') Results
        ol#resultList
    // Compiled and minified JavaScript
    script(src='https://code.jquery.com/jquery-3.4.1.min.js', integrity='sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=', crossorigin='anonymous')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js')
    // FUNDEMENTALS
    script.
      M.AutoInit();
      $('select').formSelect();
    script.
      // GET JSON DATA
      var dataReq = new XMLHttpRequest();
      var url = "data/data.json";
      dataReq.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
      console.log('Data loaded with success!');
      }
      };
      dataReq.open("GET", url, true);
      dataReq.send();
    script.
      // SET EMPTY FILTER ARRAY
      let filterArr = [false, false];
      let myData;
      var searchObj = new Object();
      let result;
      let string;
      // MODIFY FILTER ARRAY WITH SPAN.LEVERs
      $( "#retrospective" ).click(function() {
      if (filterArr[0] === false) {
      filterArr[0] = true;
      } else {
      filterArr[0] = false;
      }
      });
      $( "#wardfocused" ).click(function() {
      if (filterArr[1] === false) {
      filterArr[1] = true;
      } else {
      filterArr[1] = false;
      }
      });

      // WHEN YOU FIRE THE SEARCH
      $("#search").click(function() {
      // ERASE THE PREV RESULT TEXT
      $('#resultList').text('');
      // GET THE LIST TEXTs
      let instance_01 = M.FormSelect.getInstance($('#activeSubstance'));
      let actSubs = instance_01.getSelectedValues();
      let instance_02 = M.FormSelect.getInstance($('#ward'));
      let ward = instance_02.getSelectedValues();
      // IF IT'S EMPTY, SET AS "EMPTY" (1)
      if (ward === "") {
      ward = "empty"
      }

      if (actSubs === "") {
      actSubs = "empty"
      }      
      // CLEAR THE SEARCH OBJECT / ADD LIST PARAMETERS (ACTSUBS-WARD) FOR THE NEW SEARCH
      searchObj = {
        active_substance: actSubs,
        ward_focused: ward,
        retrospective: [],
        costSaving: []
      };
      // IF VALUES ARE "EMPTY", DESTROY THEM
      if (actSubs === "empty") {
      searchObj['active_substance'] = [];
      }
      if (ward === "empty") {
      searchObj['ward_focused'] = [];
      }
      // MIRROR THE FULL DATA ON THE CONSOLE
      let myData = JSON.parse(dataReq.responseText);
      // ADD THE DATE IN THE FILTER TO THE SEARCH
      if (filterArr[0] === true) {
      searchObj.retrospective = "retrospective";
      }

      if (filterArr[1] === true) {
      searchObj.costSaving = "costSaving";
      }
      
      // LET THE CODE DO THE MAGIC
      const filterEngine = Object.values(searchObj).flat();

      const result = myData.filter(({filters}) => {
        const objFilters = Object.values(filters).flat();
        return filterEngine.every(val => objFilters.includes(val));
      });
      
      // TIME TO PRESENT THE INTRO
      let resultLength = result.length;
      $("#resultText").html(`We have found ${resultLength} result(s)`);
      $('#resultRow').attr('style','display: default;');
      
      // TIME TO PRESENT THE LIST
      for (let key in result) {
      let value = result[key];
      }
      result.forEach(function(item) {
      var li = document.createElement("li");
      var text = `<a href='${item.url}' target='_blank'> ${item.title}</a>`;
      li.innerHTML = text;
      document.getElementById("resultList").appendChild(li);
      });
      });